<html>
    <head>
        <style>
            html, body {
                width: 100%;
                height: 100%;
                margin: 0;
            }
        </style>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
        <script type="text/javascript">
            var ctx, ctxWidth, ctxHeight, cellWidth, cellHeight;
            function onMessage(e){
                //console.log(e.origin); // outputs "http://www.example.com/"
                var [char, x, y, fr, fg, fb, br, bg, bb] = e.data;
                x = x/100*ctxWidth
                y = y/35*ctxHeight
                ctx.fillStyle = `rgb(${br/100*255|0}, ${bg/100*255|0}, ${bb/100*255|0})`
                ctx.fillRect(x,y,cellWidth,cellHeight)
                ctx.fillStyle = `rgb(${fr/100*255|0}, ${fg/100*255|0}, ${fb/100*255|0})`
                ctx.fillText(String.fromCharCode(char), x, y); //brogue console is 100x34
            }
            function onKeydown(e){
                var key = ({
                    38: 63232,
                    37: 63234,
                    40: 63233,
                    39: 63235,
                })[e.which || e.keyCode] || e.which || e.keyCode;
                document.getElementById('game-frame').contentWindow.postMessage([0, key, 0, e.ctrlKey?1:0, e.shiftKey?1:0], "*")
            }
            //brogue console is 100x34
            $(function(){
                ctx = document.getElementById('game-canvas').getContext("2d");
                ctxWidth = ctx.canvas.clientWidth;
                ctxHeight = ctx.canvas.clientHeight;
                cellWidth = ctxWidth/100;
                cellHeight = ctxHeight/35;
                ctx.fillRect(0, 0, ctxWidth, ctxHeight);
                ctx.font = '10px monospace';
                ctx.textBaseline = "top";
                ctx.fillStyle = 'white';
                window.addEventListener('message', onMessage, false);
                window.addEventListener('keydown', onKeydown, false);
            })
        </script>
    </head>
    <body>
        <canvas id="game-canvas" width="1000px" height="340px"></canvas>
        <iframe id="game-frame" src="brogue.html"></iframe>
    </body>
</html>